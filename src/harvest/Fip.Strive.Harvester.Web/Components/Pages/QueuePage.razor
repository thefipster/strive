@using Fip.Strive.Core.Domain.Schemas.Queue.Enums
<Headline Text="Queue" />

<MudGrid>
    <MudItem xs="3" md="6" sm="12">
        <MudTable @ref="_activeTable" T="JobDetails" Context="job" OnRowClick="@OnRowClicked" Hover="true" ServerData="@OnActiveRequested">
            <ToolBarContent>
                <MudText Typo="Typo.h2">Active Jobs</MudText>
            </ToolBarContent>
            <HeaderContent>
                <MudTh>Signalled</MudTh>
                <MudTh>Id</MudTh>
                <MudTh>Type</MudTh>
                <MudTh>Status</MudTh>
            </HeaderContent>
            <ColGroup>
                <col Style="width: 200px;"/>
                <col />
                <col Style="width: 150px;"/>
                <col Style="width: 150px;"/>
            </ColGroup>
            <RowTemplate>
                <MudTd DataLabel="Signalled">@job.SignalledAt</MudTd>
                <MudTd DataLabel="Id">@job.Id</MudTd>
                <MudTd DataLabel="Type">@job.Type</MudTd>
                <MudTd DataLabel="Status">@job.Status</MudTd>
            </RowTemplate>
            <PagerContent>
                <MudTablePager/>
            </PagerContent>
        </MudTable>
    </MudItem>

    <MudItem xs="3" md="6" sm="12">
        <MudTable @ref="_doneTable" T="JobDetails" Context="job" Hover="true" OnRowClick="@OnRowClicked" ServerData="@OnDoneRequested">
            <ToolBarContent>
                <MudText Typo="Typo.h2">Finished Jobs</MudText>
            </ToolBarContent>
            <HeaderContent>
                <MudTh>Signalled</MudTh>
                <MudTh>Id</MudTh>
                <MudTh>Type</MudTh>
                <MudTh>Status</MudTh>
            </HeaderContent>
            <ColGroup>
                <col Style="width: 200px;"/>
                <col />
                <col Style="width: 150px;"/>
                <col Style="width: 150px;"/>
            </ColGroup>
            <RowTemplate>
                <MudTd DataLabel="Signalled">@job.SignalledAt</MudTd>
                <MudTd DataLabel="Id">@job.Id</MudTd>
                <MudTd DataLabel="Type">@job.Type</MudTd>
                <MudTd DataLabel="Status">
                    <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
                        @job.Status
                        @if (job.Status == JobStatus.Failed)
                        {
                            <MudChip T="string" Class="pr-2" Color="Color.Error" Variant="Variant.Filled" Size="Size.Small"></MudChip>
                        }
                        else
                        {
                            <MudChip T="string" Class="pr-2" Color="Color.Success" Variant="Variant.Filled" Size="Size.Small"></MudChip>
                        }
                    </MudStack>
                </MudTd>
            </RowTemplate>
            <PagerContent>
                <MudTablePager/>
            </PagerContent>
        </MudTable>
    </MudItem>
</MudGrid>

<MudDialog @bind-Visible="_dialogVisible" Options="_dialogOptions">
    <TitleContent>
        <MudText Typo="Typo.h6">Error Details</MudText>
    </TitleContent>
    <DialogContent>
        <MudText Typo="Typo.button" Inline="false">Stack Trace</MudText>
        <MudText Class="pb-5">@_selectedError</MudText>
        <MudText Typo="Typo.button" Inline="false">Payload</MudText>
        <MudText>@_selectedPayload</MudText>
    </DialogContent>
</MudDialog>