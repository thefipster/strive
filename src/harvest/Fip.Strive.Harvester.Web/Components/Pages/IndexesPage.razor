@using Fip.Strive.Ingestion.Domain.Options

<Headline Text="Indexes"/>

<MudTable T="ZipIndex" Class="mb-5" Context="zip" Dense="true" Hover="true" ServerData="@OnZipIndexRequested"
          OnRowClick="@OnZipIndexRowClick">
    <ToolBarContent>
        <MudText Typo="Typo.h2">Imported Zips</MudText>
    </ToolBarContent>
    <HeaderContent>
        <MudTh>Signalled</MudTh>
        <MudTh>Hash</MudTh>
        <MudTh>File</MudTh>
        <MudTh>Signal</MudTh>
        <MudTh>Reference</MudTh>
    </HeaderContent>
    <ColGroup>
        <col Style="width: 190px;"/>
        <col Style="width: 170px;"/>
        <col/>
        <col Style="width: 320px;"/>
        <col Style="width: 320px;"/>
    </ColGroup>
    <RowTemplate>
        <MudTd DataLabel="Signalled">@zip.SignalledAt</MudTd>
        <MudTd DataLabel="Hash">@zip.Hash</MudTd>
        <MudTd DataLabel="File">@zip.Files.FirstOrDefault()?.FileName</MudTd>
        <MudTd DataLabel="Signal">@zip.SignalId</MudTd>
        <MudTd DataLabel="Reference">@zip.ReferenceId</MudTd>
    </RowTemplate>
    <NoRecordsContent>
        <MudText>No matching records found</MudText>
    </NoRecordsContent>
    <PagerContent>
        <MudTablePager/>
    </PagerContent>
</MudTable>

@if (_selectedZip != null)
{
    <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
        <MudText Typo="Typo.h2">Files of @_selectedZip.Files.First().FileName (@_selectedZip.Hash)</MudText>
        <MudSpacer />
        <MudSelect T="string" Label="Classification" ValueChanged="@OnClassificationFilterChanged">
            <MudSelectItem Value="ClassificationOptions.All">@ClassificationOptions.All</MudSelectItem>
            <MudSelectItem Disabled="true" Value="@("General-Topic")">General</MudSelectItem>
            <MudSelectItem
                Value="ClassificationOptions.Classified">@ClassificationOptions.Classified</MudSelectItem>
            <MudSelectItem
                Value="ClassificationOptions.Unclassified">@ClassificationOptions.Unclassified</MudSelectItem>
            <MudSelectItem Disabled="true" Value="@("Special-Topic")">Special</MudSelectItem>
            @foreach (var option in ClassificationOptions.EnumItems)
            {
                <MudSelectItem Value="@option">@option</MudSelectItem>
            }
        </MudSelect>
    </MudStack>
    <MudTable @ref="_fileTable" T="FileIndex" Dense="true" Hover="true" Context="file"
              ServerData="@OnFileIndexRequested" OnRowClick="@OnFileIndexRowClick">
        <HeaderContent>
                <MudTh>Signalled</MudTh>
                <MudTh>Hash</MudTh>
                <MudTh>File</MudTh>
                <MudTh>Classification</MudTh>
                <MudTh>Signal</MudTh>
                <MudTh>Reference</MudTh>
        </HeaderContent>
        <ColGroup>
            <col Style="width: 190px;"/>
            <col Style="width: 170px;"/>
            <col/>
            <col Style="width: 300px;"/>
            <col Style="width: 320px;"/>
            <col Style="width: 320px;"/>
        </ColGroup>
        <RowTemplate>
            <MudTd DataLabel="Signalled">@file.SignalledAt</MudTd>
            <MudTd DataLabel="Hash">@file.Hash</MudTd>
            <MudTd DataLabel="File">@file.Files.FirstOrDefault()?.FileName</MudTd>
            <MudTd DataLabel="Signal">@file.Source</MudTd>
            <MudTd DataLabel="Signal">@file.SignalId</MudTd>
            <MudTd DataLabel="Reference">@file.ReferenceId</MudTd>
        </RowTemplate>
        <NoRecordsContent>
            <MudText>No matching records found</MudText>
        </NoRecordsContent>
        <PagerContent>
            <MudTablePager/>
        </PagerContent>
    </MudTable>
}

@if (_selectedFile != null)
{
    <MudTable @ref="_dataTable" T="DataIndex" Dense="true" Hover="true" Context="data"
              ServerData="@OnDataIndexRequested">
        <ToolBarContent>
            <MudText Typo="Typo.h2">Data of @_selectedFile.Files.First().FileName (@_selectedFile.Hash)</MudText>
        </ToolBarContent>
        <HeaderContent>
            <MudTh>Signalled</MudTh>
            <MudTh>Hash</MudTh>
            <MudTh>Classification</MudTh>
            <MudTh>Kind</MudTh>
            <MudTh>Timestamp</MudTh>
            <MudTh>Signal</MudTh>
            <MudTh>Reference</MudTh>
        </HeaderContent>
        <ColGroup>
            <col Style="width: 190px;"/>
            <col Style="width: 170px;"/>
            <col/>
            <col Style="width: 200px;"/>
            <col Style="width: 300px;"/>
            <col Style="width: 320px;"/>
            <col Style="width: 320px;"/>
        </ColGroup>
        <RowTemplate>
            <MudTd DataLabel="Signalled">@data.SignalledAt</MudTd>
            <MudTd DataLabel="Hash">@data.Hash</MudTd>
            <MudTd DataLabel="Source">@data.Source</MudTd>
            <MudTd DataLabel="Kind">@data.Kind</MudTd>
            <MudTd DataLabel="Timestamp">
                @if (data.Kind == DataKind.Day)
                {
                    @data.Timestamp.ToString(DateHelper.UiDayFormat)
                }
                else
                {
                    @data.Timestamp.ToString(DateHelper.UiMinuteFormat)
                }
            </MudTd>
            <MudTd DataLabel="Signal">@data.SignalId</MudTd>
            <MudTd DataLabel="Reference">@data.ReferenceId</MudTd>
        </RowTemplate>
        <NoRecordsContent>
            <MudText>No matching records found</MudText>
        </NoRecordsContent>
        <PagerContent>
            <MudTablePager/>
        </PagerContent>
    </MudTable>
}